<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LanChat</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
  .hidden { display: none; }
  #chatChoicePage, #globalPage, #lobbyPage { padding: 20px; }
  input { padding: 8px; margin: 5px; width: 200px; }
  button { padding: 8px 12px; margin: 5px; }
  #globalMessages, #lobbyMessages { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; background: #fff; margin-bottom: 10px; }
  .message { margin: 5px 0; }
  .message span { font-weight: bold; margin-right: 5px; }
</style>
</head>
<body>

<!-- Login / Choice Page -->
<div id="chatChoicePage">
  <h2>Welcome to LanChat</h2>
  <input id="usernameInput" placeholder="Enter your name"/>
  <button id="captchaBtn">Complete CAPTCHA</button>
  <br>
  <button id="joinGlobalBtn">Join Global Chat</button>
  <br><br>
  <input id="joinLobbyInput" placeholder="Lobby Code (6 letters)"/>
  <button id="joinLobbyBtn">Join Lobby</button>
</div>

<!-- Global Chat Page -->
<div id="globalPage" class="hidden">
  <h2>Global Chat</h2>
  <div id="globalMessages"></div>
  <input id="globalMsgInput" placeholder="Type message"/>
  <button id="sendGlobalBtn">Send</button>
  <br>
  <button id="backFromGlobal">Back</button>
</div>

<!-- Lobby Chat Page -->
<div id="lobbyPage" class="hidden">
  <h2>Lobby: <span id="lobbyCodeSpan"></span></h2>
  <div id="lobbyMessages"></div>
  <input id="lobbyMsgInput" placeholder="Type message"/>
  <button id="sendLobbyBtn">Send</button>
  <br>
  <button id="backFromLobby">Back</button>
</div>

<script>
// --- Variables ---
let username = '';
let captchaPassed = false;
let activeChat = null;
let currentLobby = null;

// Bad-word filter
const badWords = ['badword1', 'badword2'];
function filterMessage(msg) {
  let filtered = msg;
  badWords.forEach(word => {
    const regex = new RegExp(word, 'gi');
    filtered = filtered.replace(regex, '*'.repeat(word.length));
  });
  return filtered;
}

// --- Elements ---
const usernameInput = document.getElementById('usernameInput');
const captchaBtn = document.getElementById('captchaBtn');
const joinGlobalBtn = document.getElementById('joinGlobalBtn');
const joinLobbyBtn = document.getElementById('joinLobbyBtn');
const joinLobbyInput = document.getElementById('joinLobbyInput');

const chatChoicePage = document.getElementById('chatChoicePage');
const globalPage = document.getElementById('globalPage');
const lobbyPage = document.getElementById('lobbyPage');
const lobbyCodeSpan = document.getElementById('lobbyCodeSpan');

const globalMessages = document.getElementById('globalMessages');
const lobbyMessages = document.getElementById('lobbyMessages');

const globalMsgInput = document.getElementById('globalMsgInput');
const sendGlobalBtn = document.getElementById('sendGlobalBtn');

const lobbyMsgInput = document.getElementById('lobbyMsgInput');
const sendLobbyBtn = document.getElementById('sendLobbyBtn');

const backFromGlobal = document.getElementById('backFromGlobal');
const backFromLobby = document.getElementById('backFromLobby');

// --- CAPTCHA Simulation ---
captchaBtn.addEventListener('click', () => {
  if(!usernameInput.value.trim()) {
    alert('Enter a name first!');
    return;
  }
  username = usernameInput.value.trim();
  captchaPassed = true;
  alert('CAPTCHA completed!');
});

// --- Join Global Chat ---
joinGlobalBtn.addEventListener('click', () => {
  if(!username || !captchaPassed) {
    alert('Complete CAPTCHA and enter your name first.');
    return;
  }
  chatChoicePage.classList.add('hidden');
  globalPage.classList.remove('hidden');
  activeChat = 'global';
  appendMessage(globalMessages, 'System', `You joined Global Chat`);
});

// --- Join Lobby ---
joinLobbyBtn.addEventListener('click', () => {
  if(!username || !captchaPassed) {
    alert('Complete CAPTCHA and enter your name first.');
    return;
  }
  const code = joinLobbyInput.value.trim().toUpperCase();
  if(code.length !== 6) {
    alert('Lobby code must be 6 letters.');
    return;
  }

  if(currentLobby) leaveLobby();

  currentLobby = code;
  lobbyCodeSpan.textContent = code;
  chatChoicePage.classList.add('hidden');
  lobbyPage.classList.remove('hidden');
  activeChat = 'lobby';
  appendMessage(lobbyMessages, 'System', `You joined Lobby ${code}`);
});

// --- Leave Lobby ---
function leaveLobby() {
  currentLobby = null;
  lobbyMessages.innerHTML = '';
}

// --- Send Messages ---
sendGlobalBtn.addEventListener('click', () => {
  const msg = globalMsgInput.value.trim();
  if(!msg) return;
  const filtered = filterMessage(msg);
  appendMessage(globalMessages, username, filtered);
  globalMsgInput.value = '';
});

sendLobbyBtn.addEventListener('click', () => {
  const msg = lobbyMsgInput.value.trim();
  if(!msg) return;
  const filtered = filterMessage(msg);
  appendMessage(lobbyMessages, username, filtered);
  lobbyMsgInput.value = '';
});

// --- Append Message Function ---
function appendMessage(container, sender, msg) {
  const div = document.createElement('div');
  div.className = 'message';
  div.innerHTML = `<span>${sender}:</span> ${msg}`;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

// --- Back Buttons ---
backFromGlobal.addEventListener('click', () => {
  globalPage.classList.add('hidden');
  chatChoicePage.classList.remove('hidden');
  activeChat = null;
});

backFromLobby.addEventListener('click', () => {
  lobbyPage.classList.add('hidden');
  chatChoicePage.classList.remove('hidden');
  leaveLobby();
  activeChat = null;
});
</script>
</body>
</html>
